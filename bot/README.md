# Telegram Bot

Telegram бот на aiogram для работы с пользователями и интеграцией с Bitrix24.

## Функционал

1. **Команда /start**
   - Регистрирует пользователя в БД
   - Создает лид в Bitrix24 с TelegramID

2. **Проверка прав администратора**
   - Админы видят кнопку "Посмотреть пользователей"
   - Обычные пользователи видят кнопки для заполнения анкеты

3. **Анкета через бот**
   - Пошаговый диалог для ввода имени и телефона
   - Обновление лида в Bitrix24

4. **Анкета через webapp**
   - Открытие формы в браузере через Telegram WebApp
   - Предзаполнение существующих данных
   - Сохранение и обновление лида в Bitrix24

5. **Отслеживание статуса**
   - Автоматическое обновление статуса при выходе с группы

6. **AI обработчик сообщений**
   - Обрабатывает текстовые сообщения вне контекста бота
   - Отправляет запросы в AI API (`/api/answer`)
   - Не мешает работе форм и команд

## Запуск

### Через Docker

```bash
cd docker
docker-compose up bot
```

Или запустить все сервисы вместе:

```bash
cd docker
docker-compose up
```

## Требования

- Запущенный API сервер (из папки `app`) или через Docker
- Настроенный `BOT_TOKEN` в переменных окружения
- Настроенный `BITRIX24_WEBHOOK_URL` (опционально)

## Docker

Бот автоматически определяет, запущен ли он в Docker, и использует правильный хост для подключения к API:
- В Docker: `http://api:8000/api`
- Локально: `http://localhost:8000/api` (или значение из `WEBAPP_HOST`)

